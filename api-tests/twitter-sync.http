### Sync Twitter Bookmarks (Success - Single)
# New App Router endpoint: /api/twitter/sync (synchronous insert via RPC)
# Response: { data: { inserted: N, skipped: N }, error: null }
# Bookmarks are deduped and inserted synchronously, then queued for AI enrichment
POST {{$dotenv API_BASE_URL}}/twitter/sync
Authorization: Bearer {{$dotenv USER_TOKEN}}
Content-Type: application/json

{
  "bookmarks": [{
    "url": "https://x.com/SawyerMerritt/status/1986170355535286529",
    "title": "Sawyer Merritt",
    "description": "BREAKING: SpaceX has announced that @Starlink now has over 8 million customers",
    "type": "tweet",
    "ogImage": "https://pbs.twimg.com/media/G5BK9fuXcAAXZ5Y.jpg",
    "meta_data": {
      "favIcon": "https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://x.com&size=128",
      "twitter_avatar_url": "https://pbs.twimg.com/profile_images/1837744842715082752/xH9vYixL_normal.jpg"
    },
    "inserted_at": "2026-01-20T08:53:32.394Z",
    "sort_index": "1848019423856806627"
  }]
}

### Sync Multiple Tweets (batch)
# Expected: { data: { inserted: 2, skipped: 0 }, error: null }
POST {{$dotenv API_BASE_URL}}/twitter/sync
Authorization: Bearer {{$dotenv USER_TOKEN}}
Content-Type: application/json

{
  "bookmarks": [
    {
      "url": "https://x.com/narendramodi/status/1984243645050945961",
      "title": "Modi",
      "description": "First batch tweet",
      "type": "tweet",
      "ogImage": null,
      "meta_data": {
        "favIcon": "https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://x.com&size=128",
        "twitter_avatar_url": "https://pbs.twimg.com/profile_images/1833509376528945157/5AeMNn9f_normal.jpg"
      },
      "inserted_at": "2026-01-28T16:59:49.475Z",
      "sort_index": "1847926557696091535"
    },
    {
      "url": "https://x.com/elonmusk/status/1985699323099713668",
      "title": "Musk",
      "description": "Second batch tweet",
      "type": "tweet",
      "ogImage": null,
      "meta_data": {
        "favIcon": "https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://x.com&size=128",
        "twitter_avatar_url": "https://pbs.twimg.com/profile_images/2008546467615580160/57KcqsTA_normal.jpg"
      },
      "inserted_at": "2026-01-28T16:59:54.475Z",
      "sort_index": "1847927476774215422"
    }
  ]
}

### Duplicate Detection Test
# Send the SAME bookmark as the first test above.
# If already inserted, expected: 200 with { data: { inserted: 0, skipped: 1 }, error: null }
# If not yet inserted, expected: 200 with { data: { inserted: 1, skipped: 0 }, error: null }
POST {{$dotenv API_BASE_URL}}/twitter/sync
Authorization: Bearer {{$dotenv USER_TOKEN}}
Content-Type: application/json

{
  "bookmarks": [{
    "url": "https://x.com/SawyerMerritt/status/1986170355535286529",
    "title": "Sawyer Merritt",
    "description": "BREAKING: SpaceX has announced that @Starlink now has over 8 million customers",
    "type": "tweet",
    "ogImage": "https://pbs.twimg.com/media/G5BK9fuXcAAXZ5Y.jpg",
    "meta_data": {
      "favIcon": "https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://x.com&size=128",
      "twitter_avatar_url": "https://pbs.twimg.com/profile_images/1837744842715082752/xH9vYixL_normal.jpg"
    },
    "inserted_at": "2026-01-20T08:53:32.394Z",
    "sort_index": "1848019423856806627"
  }]
}

### Sync Tweet with All Optional Fields (including video_url)
POST {{$dotenv API_BASE_URL}}/twitter/sync
Authorization: Bearer {{$dotenv USER_TOKEN}}
Content-Type: application/json

{
  "bookmarks": [{
    "url": "https://www.x.com/testuser/status/1990000000000000001",
    "title": "Full Tweet",
    "description": "Tweet with all fields including video",
    "type": "tweet",
    "ogImage": "https://pbs.twimg.com/media/full.jpg",
    "sort_index": "1848019423856806627",
    "inserted_at": "2026-01-15T10:30:00.000Z",
    "meta_data": {
      "favIcon": "https://abs.twimg.com/favicons/twitter.3.ico",
      "twitter_avatar_url": "https://pbs.twimg.com/profile_images/avatar.jpg",
      "video_url": "https://video.twimg.com/ext_tw_video/video.mp4"
    }
  }]
}

### Sync Tweet with Minimal Fields (defaults applied)
# title, description default to "", ogImage defaults to null
POST {{$dotenv API_BASE_URL}}/twitter/sync
Authorization: Bearer {{$dotenv USER_TOKEN}}
Content-Type: application/json

{
  "bookmarks": [{
    "url": "https://x.com/testuser/status/1990000000000000002",
    "type": "tweet",
    "meta_data": {},
    "sort_index": "1848019423856806628"
  }]
}

### Sync Tweet from twitter.com domain
POST {{$dotenv API_BASE_URL}}/twitter/sync
Authorization: Bearer {{$dotenv USER_TOKEN}}
Content-Type: application/json

{
  "bookmarks": [{
    "url": "https://twitter.com/testuser/status/1990000000000000003",
    "title": "Old Domain Tweet",
    "description": "From twitter.com",
    "type": "tweet",
    "meta_data": {},
    "sort_index": "1848019423856806629"
  }]
}

### Validation Error - Empty Bookmarks Array
# Expected: 400 - At least one bookmark required
POST {{$dotenv API_BASE_URL}}/twitter/sync
Authorization: Bearer {{$dotenv USER_TOKEN}}
Content-Type: application/json

{
  "bookmarks": []
}

### Validation Error - Missing Bookmarks Field
# Expected: 400 - Zod validation error
POST {{$dotenv API_BASE_URL}}/twitter/sync
Authorization: Bearer {{$dotenv USER_TOKEN}}
Content-Type: application/json

{}

### Validation Error - Invalid URL Format
# Expected: 400 - url must be a valid URL
POST {{$dotenv API_BASE_URL}}/twitter/sync
Authorization: Bearer {{$dotenv USER_TOKEN}}
Content-Type: application/json

{
  "bookmarks": [{
    "url": "not-a-valid-url",
    "title": "Invalid URL Test",
    "description": "Test description",
    "type": "tweet",
    "meta_data": {},
    "sort_index": "1848019423856806630"
  }]
}

### Auth Error - No Token
# Expected: 401 - Not authenticated
POST {{$dotenv API_BASE_URL}}/twitter/sync
Content-Type: application/json

{
  "bookmarks": [{
    "url": "https://x.com/testuser/status/1990000000000000004",
    "title": "No Auth Test",
    "description": "Test without auth",
    "type": "tweet",
    "meta_data": {},
    "sort_index": "1848019423856806631"
  }]
}
